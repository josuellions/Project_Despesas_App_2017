var _this=this;function formataData(){dt=new Date;let a=dt.getDate(),b=dt.getMonth(),c=dt.getFullYear();return!(10>b.toString().length)||(b=+parseInt(b+1)),1!=a.toString().length||(a='0'+a),1!=b.toString().length||(b='0'+b),c+'-'+b+'-'+a}function formataValor(a){let b=null,c=6<a.length&&9>a.length&&a.length-6;return 6<a.length&&9>a.length&&(b=a.substr(0,c)+'.'+a.substr(c++)),c=8<a.length&&12>a.length&&a.length-9,8<a.length&&12>a.length&&(b=a.substr(0,2)+'.'+a.substr(2,3)+'.'+a.substr(5)),b?b:a}let convertMes=()=>{let a,b=document.getElementById('dtReference').innerText,c=b.substr(0,3),d=b.substr(4);['JAN','FEV','MAR','ABR','MAI','JUN','JUL','AGO','SET','OUT','NOV','DEZ'].forEach(function(g,h){9>=h?h='0'+ ++h:++h,c!=g||(a=d+'-'+h+'-01')}),document.getElementById('comparaDt').innerHTML=a},localDB=null;function onInit(a){try{window.openDatabase?(initDB(),createTables()):alert('Erro: Seu navegador n\xE3o permite banco de dados.'),1!==a||queryAndUpdateOverviewLancaDespesas(),2!==a||queryAndUpdateOverviewLancaEntrada(),3!==a||$(document).ready(()=>{queryAndUpdateOverviewVizualizarDespesas()})}catch(c){return void(2==c?alert('Erro: Vers\xE3o de banco de dados inv\xE1lida.'):alert('Erro: Erro desconhecido: '+c+'.'))}}function initDB(){localDB=window.openDatabase('bdDespesas','1.0','BdGestorDespesas',65536)}function createTables(){['CREATE TABLE IF NOT EXISTS TbDespesas(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, dtLanc VARCHAR NOT NULL, data VARCHAR NOT NULL, despesa VARCHAR NOT NULL, valor FLOAT NOT NULL);','CREATE TABLE IF NOT EXISTS TbEntradas(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, dtLanc VARCHAR NOT NULL, data VARCHAR NOT NULL, entrada VARCHAR NOT NULL, valor FLOAT NOT NULL);'].forEach(function(b){try{localDB.transaction(function(d){d.executeSql(b,[],nullDataHandler,errorHandler)})}catch(d){return void alert('Erro: Data base \'TbDespesas\' n\xE3o criada '+d+'.')}})}let dtbaseBd=()=>{onInit(_this.comp);try{localDB.transaction(function(b){0,b.executeSql('SELECT * FROM TbEntradas;',[],function(c,d){for(let f=0;f<d.rows.length;f++){let g=d.rows.item(f),h=convertMes(g.dtLanc.slice(5,7),g.dtLanc.slice(0,4));document.getElementById('comparaDt').innerHTML=h}},function(c,d){alert('Erro: '+d.code+'<br>Mensagem: '+d.message)})})}catch(b){alert('Error: SELECT n\xE3o realizado '+b+'.')}};onInit(this.comp);let query='SELECT * FROM TbEntradas;';try{localDB.transaction(function(a){a.executeSql(query,[],function(b,c){for(let f,d=0;d<c.rows.length;d++)f=c.rows.item(d)},function(b,c){alert('Erro: '+c.code+'<br>Mensagem: '+c.message)})})}catch(a){alert('Error: SELECT n\xE3o realizado '+a+'.')}function onDelete(a){try{localDB.transaction(function(c){c.executeSql('delete from TbDespesas where id=?;',[a],function(d,f){f.rowsAffected?location.reload():alert('E0.00rro: Delete n\xE3o realizado.')},errorHandler)})}catch(c){alert('Erro: DELETE n\xE3o realizado '+c+'.')}}function onDeleteEntrada(a){try{localDB.transaction(function(c){c.executeSql('delete from TbEntradas where id=?;',[a],function(d,f){f.rowsAffected?location.reload():alert('Erro: Delete n\xE3o realizado.')},errorHandler)})}catch(c){alert('Erro: DELETE n\xE3o realizado '+c+'.')}}function onCreate(){let a=formataData(),b=document.getElementById('dtDespesa').value,c=document.getElementById('selectDespesas').value,d=document.getElementById('valDespesa').value;if(!(7<=d.length)||(d=d.substr(0,1)+d.substr(2)),''==b||''==c||''==d||0>d)0>d?$('#valDespesa').select():alert('Erro: \'Data\', \'Despesa\' e \'Valor\' s\xE3o campos obrigat\xF3rios!');else{try{localDB.transaction(function(g){g.executeSql('insert into TbDespesas (dtLanc, data, despesa, valor) VALUES (?, ?, ?, ?);',[a,b,c,d],function(h,j){j.rowsAffected?location.reload():alert('Erro: Inser\xE7\xE3o n\xE3o realizada')},errorHandler)})}catch(g){alert('Erro: INSERT n\xE3o realizado '+g+'.')}}}function onCreateEntrada(){let a=formataData(),b=document.getElementById('dtEntrada').value,c=document.getElementById('textEntrada').value,d=document.getElementById('valEntrada').value;if(!(7<=d.length)||(d=d.substr(0,1)+d.substr(2)),''==b||''==c||''==d||0>d)0>d?$('#valEntrada').select():alert('Erro: \'Data\', \'Despesa\' e \'Valor\' s\xE3o campos obrigat\xF3rios!');else{try{localDB.transaction(function(g){g.executeSql('insert into TbEntradas (dtLanc, data, entrada, valor) VALUES (?, ?, ?, ?);',[a,b,c,d],function(h,j){j.rowsAffected?location.reload():alert('Erro: Inser\xE7\xE3o n\xE3o realizada')},errorHandler)})}catch(g){alert('Erro: INSERT n\xE3o realizado '+g+'.')}}}let somaDespesaVisualizar=0,cont=0;function queryAndUpdateOverviewVizualizarDespesas(){convertMes();let a=document.getElementById('comparaDt').innerText.slice(0,7);try{let c,d,f,g,h;localDB.transaction(function(k){k.executeSql('SELECT * FROM TbDespesas;',[],function(l,m){for(let o,n=0;n<m.rows.length;n++)if(o=m.rows.item(n),verif=o.data.slice(0,7)==a,!0==verif&&1==cont){let p=document.createElement('td');p.setAttribute('id',o.id),p.setAttribute('class','date col-xs-12'),p.setAttribute('onclick','onSelect(this)'),c=o.data.substr(8,10),d=o.data.substr(4,5),f=d.substr(1,2),g=o.data.substr(2,2),h=c+'/'+f,$('#visualizaDesp').append('<tr><td>'+h+'</td><td>'+o.despesa+'</td><td>R$ '+o.valor+'</td></tr>'),somaDespesaVisualizar+=parseFloat(o.valor.replace(',','.')),valorFormatDespVisualiza=formataValor(somaDespesaVisualizar.toFixed(2).replace('.',',')),$('#totalDespesas').html(valorFormatDespVisualiza).css('text-align','right'),$('#calculototalDespesas').html(valorFormatDespVisualiza).css('text-align','right'),cont=1}else'/public/visualiza.html'===window.location.pathname&&(document.getElementById('totalDespesas').innerText='0,00',document.getElementById('calculototalDespesas').innerText='0,00',document.getElementById('visualizaDesp').innerText='')},function(l,m){alert('Erro: '+m.code+'<br>Mensagem: '+m.message)})})}catch(c){alert('Error: SELECT n\xE3o realizado '+c+'.')}queryEntrad='SELECT * FROM TbEntradas;';try{let c,d,f,g,h,j=0,k=0,m;localDB.transaction(function(n){n.executeSql(queryEntrad,[],function(o,p){for(let r,q=0;q<p.rows.length;q++)if(r=p.rows.item(q),verif=r.data.slice(0,7)==a,!0==verif){let s=document.createElement('td');s.setAttribute('id',r.id),s.setAttribute('class','date col-xs-12'),s.setAttribute('onclick','onSelect(this)'),c=r.data.substr(8,10),d=r.data.substr(4,5),f=d.substr(1,2),g=r.data.substr(2,2),h=c+'/'+f,j+=parseFloat(r.valor.replace(',','.')),$('#visualizaEntrada').append('<tr><td>'+h+'</td><td>'+r.entrada+'</td><td>R$ '+r.valor+'</td></tr>'),k=j-somaDespesaVisualizar,k=formataValor(k.toFixed(2).replace('.',',')),m=formataValor(parseFloat(j)).toFixed(2).replace('.',','),$('#totalEntrada').html(m).css('text-align','right'),$('#calculototalEntrada').html(m).css('text-align','right');let t=0 .toFixed(2).replace('.',',');k<=t?$('#calculosomaGeral').html(k).css({'text-align':'right',color:'red'}):$('#calculosomaGeral').html(k).css('text-align','right'),cont=1,somaDespesaVisualizar=0}else'/public/visualiza.html'==window.location.pathname&&(document.getElementById('totalEntrada').innerText='0,00',document.getElementById('calculototalEntrada').innerText='0,00',document.getElementById('calculosomaGeral').innerText='0,00',document.getElementById('visualizaEntrada').innerText='')},function(o,p){alert('Erro: '+p.code+'<br>Mensagem: '+p.message)})})}catch(c){alert('Error: SELECT n\xE3o realizado '+c+'.')}}function queryAndUpdateOverviewLancaDespesas(){try{let b,c,d,f,g,h=0;localDB.transaction(function(j){j.executeSql('SELECT * FROM TbDespesas;',[],function(k,l){for(let n,m=0;m<l.rows.length;m++){n=l.rows.item(m),b=n.data.substr(8,10),c=n.data.substr(4,5),d=c.substr(1,2),f=n.data.substr(2,2),g=b+'/'+d;let o=n.valor;$('#tbDespesas > tbody').append('<tr><td width="22%">'+g+'</td><td width="48%">'+n.despesa+'</td><td width="30%">R$ '+o+'</td><td width="5%><a href="" id="'+n.id+'" onclick="onDelete( '+n.id+' )"><span class="glyphicon glyphicon-trash"></a></span></td></tr>'),h+=parseFloat(n.valor.replace(',','.'))}valorFormatDespesa=formataValor(h.toFixed(2).replace('.',',')),$('#somaDespesas').append(valorFormatDespesa)},function(k,l){alert('Erro: '+l.code+'<br>Mensagem: '+l.message)})})}catch(b){alert('Error: SELECT n\xE3o realizado '+b+'.')}}function queryAndUpdateOverviewLancaEntrada(){try{let b,c,d,f,g,h=0;localDB.transaction(function(k){k.executeSql('SELECT * FROM TbEntradas;',[],function(l,m){for(let o,n=0;n<m.rows.length;n++){o=m.rows.item(n),b=o.data.substr(8,10),c=o.data.substr(4,5),d=c.substr(1,2),f=o.data.substr(2,2),g=b+'/'+d;let p=o.valor;$('#tbEntrada > tbody').append('<tr><td width="22%">'+g+'</td><td width="48%">'+o.entrada+'</td><td width="30%">R$ '+p+'</td><td width="5%><a href="" id="'+o.id+'" onclick="onDeleteEntrada( '+o.id+' )"><span class="glyphicon glyphicon-trash"></a></span></td></tr>'),h+=parseFloat(o.valor.replace(',','.'))}valorFormat=formataValor(h.toFixed(2).replace('.',',')),$('#valTotal').html(valorFormat)},function(l,m){alert('Erro: '+m.code+'<br>Mensagem: '+m.message)})})}catch(b){alert('Error: SELECT n\xE3o realizado '+b+'.')}}errorHandler=function(a,b){return alert('Erro: '+b.message),!0},nullDataHandler=function(){};